FormatVersion: OOS-2019-06-01
Description: Assigns a public IP address to an instance.
Parameters:
  instanceId:
    Description: The ID of the instance to be allocated an IP address.
    Type: String
    AllowedPattern: i-[A-Za-z0-9]*
    MinLength: 1
    MaxLength: 30
Tasks:
- Name: checkInstanceReady
  Action: ACS::CheckFor
  Description: Checks whether the ECS instance status is running or stopped.
  Properties:
    Service: ECS
    API: DescribeInstances
    Parameters:
      InstanceIds:
      - '{{ instanceId }}'
    DesiredValues:
    - Running
    - Stopped
    PropertySelector: Instances.Instance[].Status
- Name: allocatePublicIpAddress
  Action: ACS::ExecuteAPI
  Description: Assigns a public IP address to an instance.
  Properties:
    Service: ECS
    API: AllocatePublicIpAddress
    Parameters:
      InstanceId: '{{ instanceId }}'
  Outputs:
    ipAddress:
      Type: String
      ValueSelector: IpAddress
- Name: rebootInstance
  Action: ACS::ExecuteAPI
  Description: Restarts the ECS instance.
  Properties:
    Service: ECS
    API: RebootInstance
    Parameters:
      InstanceId: '{{ instanceId }}'
- Name: untilInstanceReady
  Action: ACS::WaitFor
  Description: Waits for the ECS instance to enter the running status.
  Properties:
    Service: ECS
    API: DescribeInstances
    Parameters:
      InstanceIds:
      - '{{ instanceId }}'
    DesiredValues:
    - Running
    PropertySelector: Instances.Instance[].Status
